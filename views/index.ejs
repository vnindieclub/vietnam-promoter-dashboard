<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnam Promoter Dashboard | No Headliner</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen p-4 md:p-10 font-sans text-slate-800">

    <div class="max-w-6xl mx-auto bg-white shadow-2xl rounded-2xl overflow-hidden border border-slate-200">
        <header class="bg-red-900 text-white p-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <h1 class="text-3xl font-black uppercase tracking-tight italic">Vietnam Promoter Dashboard <span class="text-white-400 font-normal not-italic text-lg ml-2">by No Headliner</span></h1>
                <div id="statusBadge" class="px-6 py-2 rounded-full text-sm font-bold uppercase transition-all duration-300 shadow-lg border-2 border-white/20">Checking...</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm opacity-90 leading-relaxed border-t border-white-800 pt-6">
                <p><strong>1. Tiered Stepping:</strong> Costs are not linear. The app automatically increases Revenue & Op costs at 200, 400, and 800 tickets to reflect venue jumps.</p>
                <p><strong>2. 40% Margin Rule:</strong> To ensure sustainability, the app calculates a "Suggested Price" where costs represent exactly 40% of gross revenue.</p>
                <p><strong>3. Market Reality:</strong> A show is "Practical" only if the Suggested Price stays below the audience's spending cap in Vietnam.</p>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12">
            <div class="lg:col-span-5 p-8 bg-slate-50 border-r border-slate-200 space-y-8">
                <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Adjust Variables</h2>
                
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <label class="text-sm font-bold text-slate-700">Ticket Volume</label>
                        <input type="number" id="ticketInput" value="150" class="w-24 text-right border-b-2 border-blue-600 bg-transparent font-black text-xl outline-none text-blue-600 focus:bg-blue-50 transition-colors">
                    </div>
                    <input type="range" id="ticketSlider" min="0" max="2000" value="150" 
                           class="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                    <div class="flex justify-between text-[10px] text-slate-400 mt-2 font-bold uppercase">
                        <span>Club</span>
                        <span>Theater</span>
                        <span>Hall</span>
                        <span>Arena</span>
                    </div>
                </div>

                <div>
                    <div>
    <div class="flex justify-between items-center mb-4">
        <label class="text-sm font-bold text-slate-700">Avg Ticket Price</label>
        <input type="text" id="priceInput" value="250000" class="w-40 text-right border-b-2 border-emerald-600 bg-transparent font-black text-xl outline-none text-emerald-600 focus:bg-emerald-50 transition-colors">
    </div>
    <input type="range" id="priceSlider" min="50000" max="3000000" step="5000" value="250000" 
           class="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
</div>
</div>

                <div class="p-4 bg-white rounded-lg border border-slate-200 shadow-sm">
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase mb-1">Market Logic</h4>
                    <p class="text-xs italic text-slate-600 leading-normal" id="spendingHabitNote">
                        Analyzing Vietnamese spending habits for this venue tier...
                    </p>
                </div>
            </div>

            <div class="lg:col-span-7 p-4 md:p-8 bg-white flex flex-col">
    <h2 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4 md:mb-6">Financial Worksheet</h2>
    
    <div class="space-y-3 md:space-y-4 font-mono text-xs md:text-sm flex-grow">
        <div class="flex justify-between items-center p-3 border-b border-slate-100 gap-2">
            <span class="text-slate-500 italic">Revenue Cost</span>
            <span id="revCost" class="font-bold whitespace-nowrap text-right">0 ₫</span>
        </div>
        <div class="flex justify-between items-center p-3 border-b border-slate-100 gap-2">
            <span class="text-slate-500 italic">Operation Cost</span>
            <span id="opCost" class="font-bold whitespace-nowrap text-right">0 ₫</span>
        </div>
        <div class="flex justify-between items-center p-3 md:p-4 bg-blue-50 rounded-lg text-blue-900 gap-2">
            <span class="font-bold uppercase font-sans text-[10px] md:text-xs">Ideal Price (40% Margin)</span>
            <span id="suggestedPrice" class="font-black text-sm md:text-lg whitespace-nowrap text-right">0 ₫</span>
        </div>
    </div>

    <div class="mt-6 md:mt-8">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4 text-center">
            <div id="profitCardVND" class="p-3 md:p-4 bg-slate-900 text-white rounded-xl transition-all">
                <p class="text-[9px] md:text-[10px] uppercase opacity-60 mb-1 font-sans">Profit (VND)</p>
                <p id="profitVND" class="text-lg md:text-xl font-bold truncate">0 ₫</p>
            </div>
            <div id="profitCardUSD" class="p-3 md:p-4 bg-emerald-600 text-white rounded-xl shadow-lg transition-all">
                <p class="text-[9px] md:text-[10px] uppercase opacity-70 mb-1 font-sans">Profit (USD)</p>
                <p id="profitUSD" class="text-lg md:text-xl font-bold truncate">$0.00</p>
            </div>
        </div>
        <p class="text-[9px] md:text-[10px] text-center mt-4 text-slate-400 uppercase tracking-widest font-bold">To share between promoter and artists</p>
    </div>
</div>
    <p class="text-[10px] text-center mt-4 text-slate-400 uppercase tracking-widest font-bold">
        To share between promoter and artists
    </p>
</div>
                </div>
            </div>
            <footer class="bg-white-900 border-t border-white-800 p-6 text-center text-slate/50">
            <p class="text-sm font-bold uppercase tracking-tighter">
                Developed by <span class="text-red-400">No Headliner</span> / Vietnam Indie Club
            </p>
            <p class="text-xs mt-1">
                Contact <a href="mailto:sayhi@vnindie.club" class="underline hover:text-white transition-colors">sayhi@vnindie.club</a> to get support touring in Vietnam
            </p>
        </footer>
        </div>

    </div>

  <script>
    const tSlider = document.getElementById('ticketSlider');
    const tInput = document.getElementById('ticketInput');
    const pSlider = document.getElementById('priceSlider');
    const pInput = document.getElementById('priceInput');
    let USD_RATE = 26300; // Fallback rate

    // Fetch Live Exchange Rate
    async function fetchExchangeRate() {
        try {
            // Using ExchangeRate-API (Free Tier)
            const response = await fetch('https://open.er-api.com/v6/latest/USD');
            const data = await response.json();
            
            if (data && data.rates && data.rates.VND) {
                // We add a small 1% 'Buffer' for bank fees/volatility (optional)
                USD_RATE = data.rates.VND * 1.01; 
                console.log("Live Rate Updated:", USD_RATE);
                updateCalculations(); // Refresh UI with new rate
            }
        } catch (error) {
            console.error("Exchange Rate Fetch Failed, using fallback.");
        }
    }

    // Helper to turn "500,000 ₫" back into 500000
    function cleanNumber(val) {
        return parseInt(val.replace(/[^0-9]/g, '')) || 0;
    }

    function updateCalculations(source) {
        let tickets = parseInt(tInput.value) || 0;
        let userPrice = cleanNumber(pInput.value);

        // Syncing Logic
        if(source === 'tS') { tickets = tSlider.value; tInput.value = tickets; }
        if(source === 'tI') { tSlider.value = tickets; }
        
        if(source === 'pS') { userPrice = pSlider.value; pInput.value = parseInt(userPrice).toLocaleString() + " ₫"; }
        if(source === 'pI') { pSlider.value = userPrice; pInput.value = userPrice.toLocaleString() + " ₫"; }

        let revCost, opCost, marketCeiling, tierName;

        // TIER LOGIC
        if (tickets <= 150) {
            revCost = 5000000; opCost = 5000000; marketCeiling = 250000; tierName = "Club/Small Venue";
        } else if (tickets <= 400) {
            revCost = 25000000; opCost = 45000000; marketCeiling = 450000; tierName = "Theater/Livehouse";
        } else if (tickets <= 800) {
            revCost = 80000000; opCost = 70000000; marketCeiling = 850000; tierName = "Event Hall";
        } else {
            revCost = 200000000; opCost = 300000000; marketCeiling = 1500000; tierName = "Stadium/Arena";
        }

        const totalCost = revCost + opCost;
        const suggestedPrice = (totalCost / 0.6) / (tickets || 1); 
        const profitVND = (userPrice * tickets) - totalCost;
const isAffordable = suggestedPrice <= marketCeiling;
const isProfitable = profitVND > 0;

        // UI UPDATES
        document.getElementById('revCost').innerText = revCost.toLocaleString() + " ₫";
        document.getElementById('opCost').innerText = opCost.toLocaleString() + " ₫";
        document.getElementById('suggestedPrice').innerText = Math.round(suggestedPrice).toLocaleString() + " ₫";
        document.getElementById('profitVND').innerText = profitVND.toLocaleString() + " ₫";
       const formattedUSD = profitVND / USD_RATE;
document.getElementById('profitUSD').innerText = "$" + formattedUSD.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

        // PROFIT CARD COLOR LOGIC (2-COLUMN GRID)
        const cardVND = document.getElementById('profitCardVND');
        const cardUSD = document.getElementById('profitCardUSD');
        if (profitVND < 0) {
            cardVND.className = "p-4 bg-orange-500 text-white rounded-xl transition-all duration-300";
            cardUSD.className = "p-4 bg-orange-600 text-white rounded-xl shadow-lg transition-all duration-300";
        } else {
            cardVND.className = "p-4 bg-slate-900 text-white rounded-xl transition-all duration-300";
            cardUSD.className = "p-4 bg-emerald-600 text-white rounded-xl shadow-lg transition-all duration-300";
        }

        // STATUS & EXPLANATION LOGIC
const badge = document.getElementById('statusBadge');
const note = document.getElementById('spendingHabitNote');

// ONLY PRACTICAL IF AFFORDABLE AND PROFITABLE
if (isAffordable && isProfitable) {
    badge.innerText = "PRACTICAL";
    badge.className = "px-6 py-2 rounded-full text-sm font-bold uppercase bg-emerald-500 text-white shadow-lg";
    note.innerText = `Success: This model aligns with Vietnamese spending habits for ${tierName} shows AND generates positive cash flow.`;
} else {
    badge.innerText = "NOT PRACTICAL";
    badge.className = "px-6 py-2 rounded-full text-sm font-bold uppercase bg-red-500 text-white shadow-lg";
    
    // Specific feedback based on why it failed
    if (!isProfitable && isAffordable) {
        note.innerText = `The price is affordable for fans, but your current settings result in a LOSS. Increase ticket price or volume to reach profitability.`;
    } else if (isProfitable && !isAffordable) {
        note.innerText = `You are making profit, but the price required to sustain your 60% margin (${Math.round(suggestedPrice).toLocaleString()} ₫) exceeds the local market limit for ${tierName}s.`;
    } else {
        note.innerText = `This model is neither profitable nor affordable for the Vietnamese market. Significant adjustments to costs or volume are required.`;
    }
}
    }

    tSlider.oninput = () => updateCalculations('tS');
    tInput.oninput = () => updateCalculations('tI');
    pSlider.oninput = () => updateCalculations('pS');
    pInput.onchange = () => updateCalculations('pI'); // Format on finish typing
    
    window.onload = () => {
        fetchExchangeRate(); // Get the live rate first
        updateCalculations('pS'); // Initial UI render
    };
</script>
</body>
</html>